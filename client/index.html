<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>first mutiplayer test</title>
    <script src="https://cdn.socket.io/socket.io-1.4.5.js">

    </script>
    <link rel="stylesheet" href="https://magicquest.github.io/clickable.css">
    <script src="https://magicquest.github.io/oof.js">

    </script>
</head>
<body>
    <center id="center" style="font-size: 30px;">
        <input style="font-size: 30px;" id="name" placeholder="type your name here!">

        </input>
        <button style="font-size: 30px;" onclick = "answer()">
            Play!
        </button>
    </center>
    <canvas style="display: none;" id="ctx">

    </canvas>
    <!--center>
        <h1>
            lmao
        </h1>
    </center-->
    <script>
        function get(doc) {
            return document.getElementById(doc);
        }
        
        function answer() {
            socket.emit('name',{name:get("name").value});
            canvas.style.display = "inline";
            get("center").style.display = "none";
        }
        var socket = io();
        var canvas = get('ctx');
        var ctx = get("ctx").getContext('2d');
        
        canvas.width = innerWidth - 5;
        canvas.height = innerHeight - 5;
        socket.emit('setSize', {
                width:canvas.width,
                height:canvas.height,
            })
        window.onbeforeunload = confirmExit;
        function rgbToHex(r, g, b) {
            return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
        }   
        addEventListener("resize",function(event) {
            canvas.width = innerWidth - 5
            canvas.height = innerHeight - 5
            socket.emit('setSize', {
                width:canvas.width,
                height:canvas.height,
            })
        })
        addEventListener("mousedown",function(event) {
            socket.emit('addFood',{x:event.x,y:event.y});
        }); 
        function componentToHex(c) {
            var hex = c.toString(16);
            return hex.length == 1 ? "0" + hex : hex;
        }
        socket.on('newData',function(data) {
            ctx.clearRect(0,0,canvas.width,canvas.height);
            ctx.font="30px Comic Sans MS";
            //print(data);
            //print(data[0].food);
            //if(data[0] != undefined) {
                for(var i = 0;i < data[0].food.length;i++) {
                    var food = data[0].food[i];
                    if(food != undefined) {
                        circle(ctx,food.x,food.y,10,360,food.color);
                    }
                    
                }
           // }
            for(var i = 0;i<data.length;i++) {

                    ctx.fillStyle = rgbToHex(data[i].color.x,data[i].color.y,data[i].color.z);
                    print(data[i].size);
                    ctx.fillText(data[i].name,data[i].x-10,data[i].y-data[i].size)
                    ctx.fillRect(data[i].x-(data[i].size/2),data[i].y-(data[i].size/2),data[i].size,data[i].size);
                
                
            }
            //ctx.fillRect(data.x-10,data.y-10,20,20);
            //ctx.fillText('N',data.x,data.y);
        });
        function confirmExit() {
            socket.emit('closed');
                //return "You have attempted to leave this page. Are you sure?";
        }
        document.onkeydown = function(event) {
            socket.emit('keyPress',{
                key:event.key,
                state:true
            })
        };
        document.onkeyup = function(event) {
            socket.emit('keyPress',{
                key:event.key,
                state:false
            })
        }
    </script>
    
</body>
</html>