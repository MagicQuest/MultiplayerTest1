<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>first mutiplayer test</title>
    <script src="https://cdn.socket.io/socket.io-1.4.5.js">

    </script>
    <link rel="stylesheet" href="https://magicquest.github.io/clickable.css">
    <script src="https://magicquest.github.io/oof.js">

    </script>
</head>
<body style="overflow: hidden;">
    <center id="center" style="font-size: 30px;">
        <input style="font-size: 30px;" id="name" placeholder="type your name here!">

        </input>
        <button style="font-size: 30px;" onclick = "answer()">
            Play!
        </button>
    </center>
    <canvas style="display: none;" id="ctx">

    </canvas>
    <!--center>
        <h1>
            lmao
        </h1>
    </center-->
    <script>
        function get(doc) {
            return document.getElementById(doc);
        }
        
        function answer() {
            socket.emit('name',{name:get("name").value});
            canvas.style.display = "inline";
            get("center").style.display = "none";
        }
        var socket = io();
        var canvas = get('ctx');
        var ctx = get("ctx").getContext('2d');
        var you = {
            x:250,
            y:250,
        };
        //var distance = {
        //    x:0,
        //    y:0,
        //}
        socket.on('you', function(data) {
            you.x = data.x;
            you.y = data.y;
            /*if(data.w) {
                distance.y-=data.maxSpeed;
            }if(data.s) {
                distance.y+=data.maxSpeed;
            }if(data.a) {
                distance.x-=data.maxSpeed;
            }if(data.d) {
                distance.x+=data.maxSpeed;
            }*/
        })
        canvas.width = innerWidth - 5;
        canvas.height = innerHeight - 5;
        socket.emit('setSize', {
                width:canvas.width,
                height:canvas.height,
            })
        window.onbeforeunload = confirmExit;
        function rgbToHex(r, g, b) {
            return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
        }   
        addEventListener("resize",function(event) {
            canvas.width = innerWidth - 5
            canvas.height = innerHeight - 5
            socket.emit('setSize', {
                width:canvas.width,
                height:canvas.height,
            })
        })
        addEventListener("mousedown",function(event) {
            //socket.emit('addFood',{x:event.x,y:event.y});
        }); 
        // b r u h   b r u h   b r u h   b r u h   b r u h   b r u h   b r u h   b u r h   b r u h   b r u h   b r u h   i   g o t t a   g o   p e e   a n d   i   m   a l s o   g o i n g   t o   s   l   e   e   p 
        function componentToHex(c) {
            var hex = c.toString(16);
            return hex.length == 1 ? "0" + hex : hex;
        }
        socket.on('newData',function(data) {
            ctx.clearRect(0,0,canvas.width,canvas.height);
            ctx.font="30px Comic Sans MS";
            //print(data);
            //print(data[0].food);
            //if(data[0] != undefined) {
                for(var i = 0;i < data[0].food.length;i++) {
                    var food = data[0].food[i];
                    if(food != undefined) {
                        var x = food.x - you.x + canvas.width/2;
                        var y = food.y - you.y + canvas.height/2;
                        circle(ctx,x/*-distance.x/2*/,y/*-distance.y/2*/,10,360,food.color);
                    }
                    
                }
           // }
            for(var i = 0;i<data.length;i++) {

                    ctx.fillStyle = rgbToHex(data[i].color.x,data[i].color.y,data[i].color.z);
                    print(data[i].size);
                    var x = data[i].x - you.x + canvas.width/2;
                    var y = data[i].y - you.y + canvas.height/2;
                    //if(data[i].x == you.x && data[i].y == you.y) {
                        ctx.fillText(data[i].name,x-10,y-data[i].size)
                        ctx.fillRect(x-(data[i].size/2),y-(data[i].size/2),data[i].size,data[i].size);
                   // }else {
                    //    ctx.fillText(data[i].name,(x-10)/*-distance.x/2*/,(y-data[i].size)/*-distance.y/2*/)
                     //   ctx.fillRect((x-(data[i].size/2))/*-distance.x/2*/,(y-(data[i].size/2))/*-distance.y/2*/,data[i].size,data[i].size);
                    //}
                    
                
                
            }
            //ctx.fillRect(data.x-10,data.y-10,20,20);
            //ctx.fillText('N',data.x,data.y);
        });
        function confirmExit() {
            socket.emit('closed');
                //return "You have attempted to leave this page. Are you sure?";
        }
        document.onkeydown = function(event) {
            socket.emit('keyPress',{
                key:event.key,
                state:true
            })
            var data = {
                key:event.key,
            }
            
        };
        document.onkeyup = function(event) {
            socket.emit('keyPress',{
                key:event.key,
                state:false
            })
        }
    </script>
    
</body>
</html>